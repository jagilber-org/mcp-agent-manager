{
  "id": "speckit-repo-bootstrap",
  "title": "SpecKit Repository Bootstrap Runbook",
  "body": "# SpecKit Repository Bootstrap Runbook\n\nStep-by-step runbook for AI agents to bootstrap SpecKit governance, constitution, and mcp-index-server integration into any repository. Written for autonomous agent execution.\n\n## Prerequisites\n\n- Access to target repository filesystem\n- mcp-index-server available (optional — bootstrap works without it, promotion step skipped)\n- Node.js environment for constitution validation\n\n## Section 1: Detection\n\nBefore scaffolding, detect what already exists to avoid overwriting.\n\n### Step 1.1: Check for existing SpecKit artifacts\n\n```\nLook for these paths:\n  .specify/                         → SpecKit folder exists\n  .specify/memory/constitution.md   → Constitution derived view exists\n  .specify/templates/spec.md        → Spec template exists\n  .specify/commands/                → Command prompts exist\n  constitution.json                 → Machine-checkable constitution exists\n  docs/constitution.md              → Human-readable constitution exists\n  specs/                            → Specs directory exists\n  .github/copilot-instructions.md   → Copilot instructions exist\n```\n\n### Step 1.2: Classify the repo state\n\n| State | Condition | Action |\n|-------|-----------|--------|\n| **Fresh** | None of the above exist | Full scaffold (Sections 2-8) |\n| **Partial** | Some files exist (e.g. constitution.json but no .specify/) | Fill gaps only (skip existing) |\n| **Complete** | All artifacts present | Validate consistency, promote to index |\n\n### Step 1.3: Read repo context\n\nBefore creating constitution, understand the repo:\n- Read `package.json` or equivalent for project name, language, test framework\n- Read `README.md` for project description\n- Count existing tests: `find tests/ -name '*.test.*' | wc -l` or equivalent\n- Check source file structure to determine architecture patterns\n- Note the primary language (TypeScript, Python, Go, etc.)\n\n## Section 2: Constitution Creation\n\nThe constitution is the single source of truth. All other governance files derive from it.\n\n### Step 2.1: Create constitution.json at repo root\n\nRetrieve the template: `instructions_dispatch({action: 'get', id: 'speckit-constitution-template'})`\n\nOr use this minimum viable structure:\n\n```json\n{\n  \"version\": \"1.0.0\",\n  \"name\": \"{repo-name}-constitution\",\n  \"description\": \"Quality gates and structural invariants for {repo-name}\",\n  \"ratifiedDate\": \"{today-iso}\",\n  \"amendedDate\": \"{today-iso}\",\n  \"articles\": [\n    {\n      \"id\": \"testing\",\n      \"title\": \"Test Requirements\",\n      \"rules\": [\n        { \"id\": \"TS-1\", \"description\": \"All tests MUST pass before commit\", \"enforced\": true },\n        { \"id\": \"TS-2\", \"description\": \"New features MUST include test coverage\", \"enforced\": true },\n        { \"id\": \"TS-3\", \"description\": \"Test count MUST NOT decrease below {current-count}\", \"enforced\": true },\n        { \"id\": \"TS-4\", \"description\": \"Test coverage MUST be tracked and maintained above project threshold\", \"enforced\": true },\n        { \"id\": \"TS-5\", \"description\": \"Tests MUST be implemented, verified passing, and results stored before commit\", \"enforced\": true },\n        { \"id\": \"TS-6\", \"description\": \"For new features, tests MUST be written and verified FAILING before implementation code (TDD)\", \"enforced\": true },\n        { \"id\": \"TS-7\", \"description\": \"Reported bugs MUST have a red-green regression test\", \"enforced\": true }\n      ]\n    },\n    {\n      \"id\": \"code-quality\",\n      \"title\": \"Code Quality\",\n      \"rules\": [\n        { \"id\": \"CQ-1\", \"description\": \"Source files MUST target <=600 lines (MUST NOT exceed 1000; template literals exempt)\", \"enforced\": true },\n        { \"id\": \"CQ-2\", \"description\": \"Each module SHOULD have a single primary responsibility\", \"enforced\": false }\n      ]\n    },\n    {\n      \"id\": \"build-deploy\",\n      \"title\": \"Build & Deploy\",\n      \"rules\": [\n        { \"id\": \"BD-1\", \"description\": \"Build MUST succeed with zero errors before commit\", \"enforced\": true },\n        { \"id\": \"BD-2\", \"description\": \"No hardcoded secrets or credentials in source\", \"enforced\": true }\n      ]\n    }\n  ],\n  \"thresholds\": {\n    \"minTestCount\": 0,\n    \"maxTestDurationMs\": 5000,\n    \"sourceFileLinesGuideline\": 400,\n    \"maxSourceFileLines\": 1000\n  }\n}\n```\n\n**Customization rules:**\n- Set `minTestCount` to current test count (or 0 for new projects)\n- Add domain-specific articles (e.g., Persistence, API Safety, Security, Data Governance) based on repo context from Step 1.3\n- Use RFC 2119 language (MUST, MUST NOT, SHOULD) in rule descriptions\n- Every rule needs a unique ID with article prefix (TS-, CQ-, BD-, GV-, SE-, DG-, etc.)\n- Use `\"enforced\": false` for subjective/aspirational rules (e.g., single responsibility)\n- Avoid snapshot-count thresholds that go stale — prefer \"all X MUST be tested\" rules\n\n\n\n### Step 2.2: Generate docs/constitution.md (derived human-readable view)\n\nCreate `docs/constitution.md` with this header:\n\n```markdown\n<!-- AUTO-GENERATED from constitution.json — do not edit directly -->\n<!-- Regenerate: node scripts/sync-constitution.cjs -->\n# {Repo Name} - Constitution\n\n## Purpose\nThis constitution defines the invariants, quality gates, and structural requirements...\n```\n\nFor each article in constitution.json, generate:\n```markdown\n## Article N - {title}\n\n1. **{rule.description}** (Rule {rule.id})\n```\n\nAppend enforcement section and validation checklist.\n\n### Step 2.3: Generate .specify/memory/constitution.md (SpecKit-consumed view)\n\nCreate `.specify/memory/constitution.md` with this header:\n\n```markdown\n<!-- AUTO-GENERATED from constitution.json — do not edit directly -->\n# {Repo Name} Constitution\n\n## Core Principles\n```\n\nCondensed format — one section per article using `### I. {title}` numbering.\nInclude governance footer with version, ratified date, amended date.\n\n## Section 2.5: PII Pre-Commit Hooks (Mandatory)\n\nEvery repo MUST have PII/secret scanning pre-commit hooks. No exceptions.\n\n### Step 2.5.1: Create .pre-commit-config.yaml\n\n```yaml\nrepos:\n  - repo: https://github.com/pre-commit/pre-commit-hooks\n    rev: v5.0.0\n    hooks:\n      - id: trailing-whitespace\n      - id: end-of-file-fixer\n      - id: check-yaml\n      - id: check-json\n      - id: check-merge-conflict\n      - id: detect-private-key\n      - id: no-commit-to-branch\n\n  - repo: https://github.com/Yelp/detect-secrets\n    rev: v1.5.0\n    hooks:\n      - id: detect-secrets\n        exclude: '^(__tests__/|test/|stress/|perf-|kusto-|debug-|.*\\\\.mjs$|package-lock\\\\.json|\\\\.secrets\\\\.baseline)'\n```\n\nThis is the proven config used across jagilber-org repos. It scans for:\n- Private keys (PEM, SSH)\n- AWS access keys, Azure storage keys, GitHub tokens, OpenAI keys\n- High-entropy strings (potential secrets)\n- Generic secret/password keywords\n- 29+ credential detector plugins via detect-secrets\n\n### Step 2.5.2: Initialize the secrets baseline\n\n```bash\n# Install pre-commit if not present\npip install pre-commit\n\n# Generate initial baseline (audit and allowlist known false positives)\ndetect-secrets scan > .secrets.baseline\n\n# Install the hooks into .git/hooks/\npre-commit install\n```\n\n### Step 2.5.3: Create .pii-allowlist (optional)\n\nIf the repo has test fixtures with synthetic PII data, create `.pii-allowlist` with glob patterns for exempted files:\n\n```\n# Files with synthetic test data (not real PII)\ntests/fixtures/*.json\nstress/*.mjs\n```\n\n### Step 2.5.4: Add to constitution\n\nEnsure the constitution includes the PII & Pre-Commit Hooks article:\n\n```json\n{\n  \"id\": \"pii-precommit\",\n  \"title\": \"PII & Pre-Commit Enforcement\",\n  \"rules\": [\n    { \"id\": \"PH-1\", \"description\": \"PII pre-commit hooks MUST be installed and active; .pre-commit-config.yaml with detect-secrets and detect-private-key MUST be present\", \"enforced\": true },\n    { \"id\": \"PH-2\", \"description\": \".secrets.baseline MUST be committed and kept current; new secrets MUST be audited before allowlisting\", \"enforced\": true },\n    { \"id\": \"PH-3\", \"description\": \"Committed source, data files, and test fixtures MUST NOT contain real PII; use synthetic data for tests\", \"enforced\": true }\n  ]\n}\n```\n\n### Step 2.5.5: Ensure .env governance\n\nVerify the repo's `.gitignore` includes:\n```\n.env\n.env.*\n!.env.example\n```\n\nIf the project uses environment variables, create `.env.example` with placeholder values:\n```\n# Required\nDATABASE_URL=postgres://user:password@localhost:5432/dbname\nAPI_KEY=your-api-key-here\n\n# Optional\nLOG_LEVEL=info\nPORT=3000\n```\n\n### Step 2.5.6: Verify hooks are active\n\n```bash\npre-commit run --all-files\n```\n\nAll checks should pass. If detect-secrets flags false positives, audit them and update `.secrets.baseline`.\n\n## Section 3: .specify/ Folder Scaffold\n\nRetrieve full layout: `instructions_dispatch({action: 'get', id: 'speckit-folder-reference'})`\n\nOr scaffold manually:\n\n### Step 3.1: Create directory structure\n\n```\n.specify/\n├── memory/\n│   └── constitution.md          (created in Step 2.3)\n├── config/\n│   └── promotion-map.json       (maps content sources to index-server metadata)\n├── templates/\n│   ├── spec.md                  (feature specification template)\n│   ├── plan.md                  (implementation plan template)\n│   └── tasks.md                 (task breakdown template)\n└── commands/\n    ├── constitution.md          (prompt for /speckit.constitution)\n    ├── specify.md               (prompt for /speckit.specify)\n    ├── plan.md                  (prompt for /speckit.plan)\n    ├── tasks.md                 (prompt for /speckit.tasks)\n    └── implement.md             (prompt for /speckit.implement)\n```\n\n### Step 3.2: Create command prompts\n\nEach file in `.specify/commands/` defines the system prompt for a slash command.\n\n**constitution.md:**\n```\nYou are reviewing or creating a project constitution.\nRead constitution.json as the single source of truth.\nValidate all rules use RFC 2119 language.\nCheck for gaps: are all critical project concerns covered?\nFlag any conflicts between articles.\nOutput a compliance report with pass/fail per article.\n```\n\n**specify.md:**\n```\nYou are creating a feature specification using the template at .specify/templates/spec.md.\nRead the constitution.json to understand project constraints.\nThe spec goes in specs/{NNN-feature-name}/spec.md.\nPrioritize user stories as independently testable MVPs.\nUse Given/When/Then acceptance scenarios.\nMark unclear requirements with [NEEDS CLARIFICATION].\n```\n\n**plan.md:**\n```\nYou are creating an implementation plan using the template at .specify/templates/plan.md.\nInput: the feature spec from specs/{NNN-feature-name}/spec.md.\nGATE: Check constitution compliance before Phase 0.\nOutput goes to specs/{NNN-feature-name}/plan.md.\nDefine project structure, dependencies, and phased approach.\n```\n\n**tasks.md:**\n```\nYou are breaking an implementation plan into actionable tasks using .specify/templates/tasks.md.\nInput: plan.md and spec.md from specs/{NNN-feature-name}/.\nGroup tasks by user story for independent implementation.\nMark parallel-safe tasks with [P].\nTests before implementation (TDD) when specified.\nOutput goes to specs/{NNN-feature-name}/tasks.md.\n```\n\n**implement.md:**\n```\nYou are implementing tasks from specs/{NNN-feature-name}/tasks.md.\nFollow the task order strictly — respect dependencies.\nRun tests after each task group.\nCommit after each logical milestone.\nValidate against constitution.json gates before marking complete.\n```\n\n### Step 3.3: Create templates (if not present)\n\nThe templates in `.specify/templates/` should follow the SpecKit conventions:\n- **spec.md** — User stories with priorities (P1/P2/P3), acceptance scenarios (Given/When/Then), requirements (FR-001...), success criteria (SC-001...)\n- **plan.md** — Technical context, constitution check gate, project structure, phase breakdown, complexity tracking\n- **tasks.md** — Tasks grouped by user story, [P] parallel markers, [US1] story labels, dependency graph\n\nRetrieve proven templates: `instructions_dispatch({action: 'get', id: 'speckit-folder-reference'})`\n\n## Section 4: specs/ Convention\n\n### Step 4.1: Create specs directory structure\n\n```\nspecs/\n├── CATEGORIES.md\n└── 000-speckit-bootstrap/\n    └── spec.md\n```\n\n### Step 4.2: Create CATEGORIES.md\n\n```markdown\n# Spec Categories\n\n| Category | Description | Priority Range |\n|----------|-------------|----------------|\n| bootstrap | Project setup and scaffolding | P1 |\n| governance | Constitution, compliance, auditing | P1-P2 |\n| feature | New functionality | P1-P3 |\n| integration | External service connections | P2-P3 |\n| performance | Optimization and benchmarking | P3 |\n| documentation | Docs, runbooks, onboarding | P3 |\n```\n\n### Step 4.3: Create the first spec (self-referential bootstrap)\n\nCreate `specs/000-speckit-bootstrap/spec.md` documenting the SpecKit integration itself. This dogfoods the convention.\n\n## Section 5: copilot-instructions.md\n\n### Step 5.1: Create or update .github/copilot-instructions.md\n\nMinimum content:\n\n```markdown\n# {Repo Name} - Copilot Instructions\n\n## Project Overview\n{Brief description from README}\n\n## Development Rules\n1. Follow the constitution in `.specify/memory/constitution.md` and `constitution.json`\n2. Use spec-driven development: specify → plan → tasks → implement\n3. All tests must pass before commit\n4. Source files target ≤400 lines (must not exceed 1000)\n\n## Agent Boundaries\nThese are behavioral guardrails — not project invariants, so they live here rather than in the constitution.\n- **Never push** to any remote without explicit user approval or request\n- **Never create a repository** (public or private) without explicit user request; public repos require explicit confirmation\n- **Never change repository visibility** (private→public) without explicit user confirmation\n- **Never delete branches, repos, or releases** without explicit user confirmation\n\n## Available Slash Commands\n- `/speckit.constitution` - Create or review project principles\n- `/speckit.specify` - Create a feature specification\n- `/speckit.plan` - Generate technical implementation plan\n- `/speckit.tasks` - Break plan into actionable tasks\n- `/speckit.implement` - Implement from tasks\n\n## Architecture\n{List primary directories and their purposes}\n\n## MCP Integration\nThis repo uses mcp-index-server for shared organizational knowledge.\n\n**Searching for knowledge:**\nBefore starting new features, researching patterns, or solving unfamiliar problems,\nsearch the index for existing instructions, runbooks, and cross-repo guidance:\n```\ninstructions_search({ keywords: [\"relevant\", \"terms\"] })\ninstructions_dispatch({ action: \"get\", id: \"instruction-id\" })\n```\n\n**Promoting knowledge:**\nAfter creating or updating significant content (constitution, architecture docs, runbooks),\npromote it to the index so other repos benefit:\n```\npromote_from_repo({ repoPath: \"/path/to/this/repo\" })\n```\n```\n\n## Section 6: VS Code Settings\n\n### Step 6.1: Add slash command recommendations\n\nCreate or update `.vscode/settings.json`:\n\n```json\n{\n  \"chat.promptFilesRecommendations\": {\n    \"speckit.constitution\": true,\n    \"speckit.specify\": true,\n    \"speckit.plan\": true,\n    \"speckit.tasks\": true,\n    \"speckit.implement\": true\n  }\n}\n```\n\n## Section 7: Index Server Integration (Optional)\n\nSkip this section if mcp-index-server is not available.\n\nmcp-index-server is the shared organizational knowledge base. It stores instructions, runbooks, architecture references, and cross-repo guidance that any agent in any workspace can search and retrieve. This section sets up both directions: **pulling knowledge** (search/lookup) and **pushing knowledge** (promotion).\n\n### Step 7.1: Verify index-server connectivity\n\n```\ninstructions_dispatch({action: 'health'})\n```\n\nIf health check fails, skip to Section 8. Bootstrap still works without the index — you just lose cross-repo knowledge sharing.\n\n### Step 7.2: Search for existing knowledge\n\nBefore creating new docs or making architectural decisions, search the index for existing guidance that may already cover your needs:\n\n```\ninstructions_search({ keywords: ['relevant', 'terms'] })\ninstructions_dispatch({ action: 'get', id: 'instruction-id' })\n```\n\n**When to search the index:**\n- Starting a new feature — search for architecture patterns from sibling repos\n- Hitting an unfamiliar problem — search for runbooks or troubleshooting guides\n- Setting up tooling (CI, linting, testing) — search for proven configurations\n- Writing a constitution article — search 'speckit-constitution-template' for the article menu\n- Before writing any doc that might already exist cross-repo\n\n**Useful searches after bootstrap:**\n```\ninstructions_search({ keywords: ['constitution', 'governance'] })\ninstructions_search({ keywords: ['architecture', 'patterns'] })\ninstructions_search({ keywords: ['{repo-name}', 'runbook'] })\n```\n\n### Step 7.3: Promote repo knowledge to the index\n\nUse the `promote_from_repo` tool to push this repo's knowledge content to the index:\n\n```\npromote_from_repo({\n  repoPath: '/absolute/path/to/repo',\n  scope: 'all'\n})\n```\n\nThe tool automatically:\n- Reads `.specify/config/promotion-map.json` for explicit source-to-instruction mappings\n- Scans `instructions/*.json` for pre-formatted instruction files\n- Uses SHA-256 content hashing to skip unchanged content (no external tracking needed)\n- Validates all entries against the instruction schema before writing\n\n**Scope options:** `all`, `governance`, `specs`, `docs`, `instructions`\n\nIf `promote_from_repo` is not yet available, fall back to manual promotion:\n```\ninstructions_dispatch({\n  action: 'add',\n  entry: {\n    id: '{repo-name}-constitution',\n    title: '{Repo Name} Constitution',\n    body: '<contents of constitution.json>',\n    priority: 5, audience: 'all', requirement: 'mandatory',\n    categories: ['governance', '{repo-name}'],\n    contentType: 'instruction', schemaVersion: '3'\n  },\n  lax: true\n})\n```\n\n### Step 7.4: Add MCP Integration to copilot-instructions\n\nEnsure `.github/copilot-instructions.md` includes an MCP Integration section so agents working in this repo know the index exists:\n\n```markdown\n## MCP Integration\nThis repo uses mcp-index-server for shared organizational knowledge.\nUse \\`instructions_search\\` to find cross-repo guidance before starting new work.\nUse \\`promote_from_repo\\` to share this repo's knowledge with other workspaces.\n```\n\n## Section 8: Validation Checklist\n\nRun these checks after bootstrap completes:\n\n- [ ] `constitution.json` exists and parses as valid JSON\n- [ ] `constitution.json` has >=1 article with >=1 rule\n- [ ] `constitution.json` version field is valid semver\n- [ ] `.specify/memory/constitution.md` exists and contains 'AUTO-GENERATED' header\n- [ ] `.specify/templates/spec.md` exists\n- [ ] `.specify/templates/plan.md` exists\n- [ ] `.specify/templates/tasks.md` exists\n- [ ] `.specify/commands/constitution.md` exists\n- [ ] `.specify/commands/specify.md` exists\n- [ ] `.specify/commands/plan.md` exists\n- [ ] `.specify/commands/tasks.md` exists\n- [ ] `.specify/commands/implement.md` exists\n- [ ] `specs/CATEGORIES.md` exists\n- [ ] `.github/copilot-instructions.md` exists and references SpecKit commands\n- [ ] `.vscode/settings.json` has `chat.promptFilesRecommendations` entries\n- [ ] All 3 constitution files are consistent (if all exist)\n- [ ] `.pre-commit-config.yaml` exists with detect-secrets and detect-private-key hooks\n- [ ] `.secrets.baseline` exists and is committed\n- [ ] `pre-commit run --all-files` passes\n- [ ] Constitution includes pii-precommit article\n- [ ] `.gitignore` includes `.env` and `.env.*` patterns\n- [ ] `.github/copilot-instructions.md` includes Agent Boundaries section\n- [ ] Architecture diagrams exist in docs/ as Mermaid-in-markdown\n- [ ] Constitution includes repo-structure article (or project structure is documented in copilot-instructions.md)\n- [ ] Index promotion succeeded (if index-server available)\n- [ ] `.github/copilot-instructions.md` includes MCP Integration section\n- [ ] Index search returns relevant results for repo name (if promoted)\n- [ ] Build succeeds with zero errors (Section 8.5, Step 1)\n- [ ] Test suite runs and all tests pass (Section 8.5, Step 2)\n- [ ] Smoke test passes — built executable starts without fatal errors (Section 8.5, Step 3, if applicable)\n- [ ] `minTestCount` in constitution.json reflects actual baseline (Section 8.5, Step 4)\n\n## Section 8.5: Functional Verification\n\nSection 8 validates that files **exist**. This section validates they **work**.\nThe constitution defines the quality gates (TS-1, BD-1, BD-4) — this section instructs the bootstrapping agent to actually execute them.\n\n### Step 8.5.1: Run the build\n\nExecute the project's build command and verify it succeeds with zero errors:\n\n```bash\n# Node/TypeScript projects\nnpm run build\n\n# Python projects\npython -m py_compile src/**/*.py\n\n# Go projects\ngo build ./...\n```\n\nIf the build fails, fix all errors before proceeding. A green build is a prerequisite for everything that follows (BD-1).\n\n### Step 8.5.2: Run the test suite\n\nExecute the full test suite and verify all tests pass:\n\n```bash\n# Node/TypeScript (vitest)\nnpx vitest run\n\n# Node/TypeScript (jest)\nnpx jest\n\n# Python\npytest\n\n# Go\ngo test ./...\n```\n\nAll tests MUST pass (TS-1). If any fail, investigate and fix before continuing.\nRecord the passing test count — this becomes the `minTestCount` baseline in Step 8.5.4.\n\n### Step 8.5.3: Smoke test the built artifact (if applicable)\n\nIf the project produces a runnable artifact (server, CLI, executable), verify it starts without fatal errors:\n\n```bash\n# Example: Node server\nnode dist/server/index.js &\n# Wait 2-4 seconds, check for:\n#   - No 'Fatal error', 'Cannot find module', 'is not defined'\n#   - No crash exit code\n#   - Expected startup banner appears\nkill %1\n\n# Example: CLI tool\n./dist/cli --help\n# Should print usage without errors\n```\n\nThis catches runtime issues that pass TypeScript compilation and test frameworks but break in production (e.g., ESM/CJS __dirname mismatches, missing runtime imports). See BD-4.\n\nIf the project does not produce a runnable artifact, skip this step.\n\n### Step 8.5.4: Record baseline metrics in constitution\n\nUpdate `constitution.json` thresholds to reflect actual baseline:\n\n```json\n{\n  \"thresholds\": {\n    \"minTestCount\": <actual-passing-test-count>\n  }\n}\n```\n\nRegenerate derived files after updating:\n```bash\nnode scripts/sync-constitution.cjs   # if sync script exists\n# Otherwise manually update docs/constitution.md and .specify/memory/constitution.md\n```\n\n### Step 8.5.5: Flag coverage gaps\n\nScan for source files with no corresponding test file:\n\n```bash\n# Example for TypeScript — list source files without matching test\nfor f in src/**/*.ts; do\n  test_file=\"tests/$(basename $f .ts).test.ts\"\n  [ ! -f \"$test_file\" ] && echo \"UNTESTED: $f\"\ndone\n```\n\nThis is informational, not blocking. Log untested files so future work can prioritize coverage.\nDo NOT fail the bootstrap over missing test files — they will be added as features are developed.\n\n## Troubleshooting\n\n| Symptom | Cause | Fix |\n|---------|-------|-----|\n| `/speckit.specify` not showing in VS Code | Missing settings.json config | Add `chat.promptFilesRecommendations` |\n| Constitution drift between files | Edited derived file directly | Re-run sync-constitution script |\n| Index promotion 404 | Index-server not running | Start index-server or skip promotion |\n| Index promotion 403 | MCP_ENABLE_MUTATION not set | Set `MCP_ENABLE_MUTATION=1` on index-server |\n| Schema validation error on add | Missing required fields | Use `lax: true` parameter |\n| Agent not searching index | copilot-instructions missing MCP section | Add MCP Integration section per Step 7.4 |\n| promote_from_repo not found | Tool not yet deployed on index-server | Use manual promotion (Step 7.3 fallback) |\n| pre-commit not found | Python pre-commit not installed | `pip install pre-commit` then `pre-commit install` |\n| detect-secrets flags false positive | Legitimate high-entropy string | Run `detect-secrets audit .secrets.baseline` to allowlist |\n| No .git/hooks/pre-commit after install | pre-commit install not run | Run `pre-commit install` in repo root |\\n| Smoke test fails with __dirname error | ESM module uses CJS globals | Replace `__dirname` with `fileURLToPath(import.meta.url)` pattern |\\n| Build passes but server crashes at startup | Runtime import resolution differs from tsc | Add smoke-startup test that spawns real `node` subprocess |\n\n## Related Instructions\n\n- `speckit-constitution-template` — Canonical constitution.json template with all field definitions\n- `speckit-folder-reference` — Full .specify/ folder layout with embedded file contents\n- `promote-from-repo-spec` — Implementation spec for the promote_from_repo tool on mcp-index-server",
  "priority": 5,
  "audience": "all",
  "requirement": "critical",
  "categories": [
    "bootstrap",
    "governance",
    "speckit",
    "runbook"
  ],
  "primaryCategory": "bootstrap",
  "contentType": "instruction",
  "schemaVersion": "3",
  "version": "1.5.0",
  "status": "approved",
  "owner": "system",
  "priorityTier": "P1",
  "classification": "internal",
  "semanticSummary": "Step-by-step runbook for AI agents to bootstrap SpecKit governance, constitution, and mcp-index-server integration into any repository from scratch. Covers detection, scaffolding, promotion, and validation.",
  "reviewIntervalDays": 90,
  "changeLog": [
    {
      "version": "1.0.0",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Initial creation — complete bootstrap runbook with 8 sections"
    },
    {
      "version": "1.1.0",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Add index knowledge lookup (Section 7.2), update promotion to use promote_from_repo, add MCP Integration to copilot-instructions template, update validation checklist and troubleshooting"
    },
    {
      "version": "1.2.0",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Add Section 2.5 PII Pre-Commit Hooks (mandatory), Agent Safety article, strengthen Testing rules (coverage + result storage), update validation checklist and troubleshooting"
    },
    {
      "version": "1.3.0",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Move Agent Safety from constitution to copilot-instructions template; add .env governance step; refine PH-3 scope; update validation checklist"
    },
    {
      "version": "1.4.0",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Add repo-structure validation checks (architecture diagrams, project structure documentation); align with constitution template v1.5.0"
    },
    {
      "version": "1.5.0",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Add Section 8.5 Functional Verification — build, test suite, smoke test, baseline metrics, coverage gap scan; ensures bootstrapping agents execute quality gates, not just check file existence"
    }
  ],
  "updatedAt": "2026-02-16T00:00:00.000Z",
  "sourceHash": "4e87264558137097460add3e0626b1fc0fa3b60daa2220b084ca70e366f95853"
}
