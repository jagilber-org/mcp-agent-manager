{
  "id": "speckit-constitution-template",
  "title": "SpecKit Constitution Template — Machine-Checkable Governance",
  "body": "# Constitution Template\n\nCanonical template for `constitution.json` — the single source of truth for project governance. Other constitution files (`.specify/memory/constitution.md`, `docs/constitution.md`) are derived views.\n\n## Schema\n\n```json\n{\n  \"version\": \"REQUIRED — semver string (e.g. 1.0.0)\",\n  \"name\": \"REQUIRED — {repo-name}-constitution\",\n  \"description\": \"REQUIRED — one-line purpose statement\",\n  \"ratifiedDate\": \"REQUIRED — ISO 8601 date of initial ratification\",\n  \"amendedDate\": \"REQUIRED — ISO 8601 date of last amendment\",\n  \"articles\": \"REQUIRED — array of Article objects (see below)\",\n  \"thresholds\": \"REQUIRED — numeric quality gates (see below)\"\n}\n```\n\n## Article Structure\n\n```json\n{\n  \"id\": \"kebab-case identifier (e.g. 'testing', 'code-quality', 'persistence')\",\n  \"title\": \"Human-readable title\",\n  \"rules\": [\n    {\n      \"id\": \"PREFIX-N (e.g. TS-1, CQ-2, PE-3) — unique across entire constitution\",\n      \"description\": \"RFC 2119 language: MUST, MUST NOT, SHOULD, SHALL, MAY\",\n      \"enforced\": true\n    }\n  ]\n}\n```\n\n## Thresholds Object\n\n```json\n{\n  \"minTestCount\": \"integer — minimum number of tests that must pass\",\n  \"maxSuiteDurationMs\": \"integer — max total test suite duration in ms\",\n  \"maxTestFileDurationMs\": \"integer — max duration for any single test file in ms\",\n  \"sourceFileLinesGuideline\": \"integer — soft limit for source file length (default 600)\",\n  \"maxSourceFileLines\": \"integer — hard limit (default 1000, template literals exempt)\"\n}\n```\n\nAdd domain-specific thresholds as needed. Avoid snapshot-count thresholds (e.g. `eventTypes: 15`) that go stale silently — prefer \"all X MUST be tested\" rules instead.\n\n## Enforced Levels\n\nUse the `enforced` field to distinguish hard gates from aspirational guidelines:\n- `\"enforced\": true` — Machine-checkable, blocks commit/deploy if violated\n- `\"enforced\": false` — Aspirational guideline, reviewed in code review but not gated\n\nSubjective rules (\"SHOULD have single responsibility\") should use `enforced: false`.\n\n## Starter Articles\n\nPick from this menu based on your project's needs.\n\n### Minimum Viable Constitution\n\nFor a new repo, start with these 5 articles and grow as needed:\n1. **Governance** — ensures the constitution itself is maintained\n2. **Testing** — quality gate for all changes\n3. **Code Quality** — structural consistency\n4. **Security** — baseline input hygiene + .env protection\n5. **PII & Pre-Commit Hooks** — mandatory commit-time scanning\n\nAdd domain-specific articles (data-integrity, resource-management, etc.) when the project reaches that complexity. Don't front-load 20 articles on day one.\n\n**Non-negotiable article:** PII & Pre-Commit Hooks is mandatory for every project regardless of complexity.\n\n**Agent behavioral rules** (no push without approval, no repo creation, no visibility changes) belong in `.github/copilot-instructions.md` under an \"Agent Boundaries\" section — they are interaction directives, not machine-checkable project invariants.\n\n### Governance (recommended for ALL projects)\n```json\n{\n  \"id\": \"governance\",\n  \"title\": \"Governance Process\",\n  \"rules\": [\n    { \"id\": \"GV-1\", \"description\": \"constitution.json is the single source of truth; derived files MUST NOT be edited directly\", \"enforced\": true },\n    { \"id\": \"GV-2\", \"description\": \"Amendments MUST update amendedDate and bump version for breaking changes\", \"enforced\": true },\n    { \"id\": \"GV-3\", \"description\": \"All rules MUST use RFC 2119 language\", \"enforced\": true }\n  ]\n}\n```\n\n### Testing (MANDATORY for ALL projects)\n```json\n{\n  \"id\": \"testing\",\n  \"title\": \"Test Requirements\",\n  \"rules\": [\n    { \"id\": \"TS-1\", \"description\": \"All tests MUST pass before commit\", \"enforced\": true },\n    { \"id\": \"TS-2\", \"description\": \"New features MUST include test coverage\", \"enforced\": true },\n    { \"id\": \"TS-3\", \"description\": \"Test count MUST NOT decrease below {minTestCount}\", \"enforced\": true },\n    { \"id\": \"TS-4\", \"description\": \"Functional tests MUST validate full pipeline round-trips\", \"enforced\": true },\n    { \"id\": \"TS-5\", \"description\": \"Test coverage MUST be tracked and maintained above project threshold\", \"enforced\": true },\n    { \"id\": \"TS-6\", \"description\": \"Tests MUST be implemented, verified passing, and results stored before commit\", \"enforced\": true },\n    { \"id\": \"TS-7\", \"description\": \"For new features and changes, tests MUST be written and verified FAILING before implementation code (TDD red-green-refactor)\", \"enforced\": true },\n    { \"id\": \"TS-8\", \"description\": \"Reported bugs MUST have a red-green regression test: write a test that reproduces the failure, then fix and verify pass\", \"enforced\": true }\n  ]\n}\n```\n\n\n### Code Quality (recommended for ALL projects)\n```json\n{\n  \"id\": \"code-quality\",\n  \"title\": \"Code Quality\",\n  \"rules\": [\n    { \"id\": \"CQ-1\", \"description\": \"Source files SHOULD target <=600 lines; MUST NOT exceed 1000 (template literals exempt)\", \"enforced\": true },\n    { \"id\": \"CQ-2\", \"description\": \"Each module MUST have a single primary responsibility; god-modules that mix unrelated concerns are prohibited\", \"enforced\": true },\n    { \"id\": \"CQ-3\", \"description\": \"Business logic SHOULD NOT be mixed with presentation\", \"enforced\": false },\n    { \"id\": \"CQ-4\", \"description\": \"Source files exceeding sourceFileLinesGuideline MUST be evaluated for decomposition during the next edit; files exceeding maxSourceFileLines MUST be split before new feature work\", \"enforced\": true },\n    { \"id\": \"CQ-5\", \"description\": \"Source code MUST follow the project's declared layered architecture; cross-layer imports MUST flow downward only\", \"enforced\": true },\n    { \"id\": \"CQ-6\", \"description\": \"When splitting a file, MUST extract by cohesive domain concept (not arbitrary line count); each extracted module MUST have a name reflecting its responsibility\", \"enforced\": true },\n    { \"id\": \"CQ-7\", \"description\": \"Service subdirectories SHOULD contain an index.ts barrel export; >=3 related files in a flat directory SHOULD be extracted into a subdirectory\", \"enforced\": false }\n  ]\n}\n```\n\n### Build & Deploy (recommended for ALL projects)\n```json\n{\n  \"id\": \"build-deploy\",\n  \"title\": \"Build & Deploy\",\n  \"rules\": [\n    { \"id\": \"BD-1\", \"description\": \"Build MUST succeed with zero errors before commit\", \"enforced\": true },\n    { \"id\": \"BD-2\", \"description\": \"No hardcoded secrets or credentials in source\", \"enforced\": true },\n    { \"id\": \"BD-3\", \"description\": \"Dependencies MUST be pinned to exact versions\", \"enforced\": true }\n  ]\n}\n```\n\n### Data Integrity (for stateful services)\n```json\n{\n  \"id\": \"data-integrity\",\n  \"title\": \"Data Integrity & Persistence\",\n  \"rules\": [\n    { \"id\": \"DI-1\", \"description\": \"All stateful data MUST persist to disk; startup MUST auto-restore\", \"enforced\": true },\n    { \"id\": \"DI-2\", \"description\": \"Corrupted or empty files MUST result in safe empty state, not crashes\", \"enforced\": true },\n    { \"id\": \"DI-3\", \"description\": \"Schema changes to persisted files MUST include migration logic or be backwards-compatible\", \"enforced\": true }\n  ]\n}\n```\n\n### API Safety (for services with APIs)\n```json\n{\n  \"id\": \"api-safety\",\n  \"title\": \"API Safety\",\n  \"rules\": [\n    { \"id\": \"AP-1\", \"description\": \"All endpoints MUST validate input\", \"enforced\": true },\n    { \"id\": \"AP-2\", \"description\": \"Error responses MUST NOT leak internal details\", \"enforced\": true },\n    { \"id\": \"AP-3\", \"description\": \"Breaking changes MUST increment major version\", \"enforced\": true }\n  ]\n}\n```\n\n### Security (recommended for ALL projects)\n```json\n{\n  \"id\": \"security\",\n  \"title\": \"Security\",\n  \"rules\": [\n    { \"id\": \"SE-1\", \"description\": \"No hardcoded secrets or credentials MUST appear in source\", \"enforced\": true },\n    { \"id\": \"SE-2\", \"description\": \"User/tool inputs MUST be validated before filesystem or shell operations\", \"enforced\": true },\n    { \"id\": \"SE-3\", \"description\": \"File paths from user input MUST be sanitized against path traversal\", \"enforced\": true },\n    { \"id\": \"SE-4\", \"description\": \"Shell command construction MUST NOT interpolate unsanitized user input\", \"enforced\": true },\n    { \"id\": \"SE-5\", \"description\": \".env and .env.* files MUST be gitignored; secrets MUST NOT be committed to the repository\", \"enforced\": true },\n    { \"id\": \"SE-6\", \"description\": \".env.example SHOULD document all expected environment variables with placeholder values (no real secrets)\", \"enforced\": false }\n  ]\n}\n```\n\n### PII & Pre-Commit Hooks (MANDATORY for ALL projects)\n```json\n{\n  \"id\": \"pii-precommit\",\n  \"title\": \"PII & Pre-Commit Enforcement\",\n  \"rules\": [\n    { \"id\": \"PH-1\", \"description\": \"PII pre-commit hooks MUST be installed and active; .pre-commit-config.yaml with detect-secrets and detect-private-key MUST be present\", \"enforced\": true },\n    { \"id\": \"PH-2\", \"description\": \".secrets.baseline MUST be committed and kept current; new secrets MUST be audited before allowlisting\", \"enforced\": true },\n    { \"id\": \"PH-3\", \"description\": \"Committed source, data files, and test fixtures MUST NOT contain real PII; use synthetic data for tests\", \"enforced\": true }\n  ]\n}\n```\n\n### Data Governance (for projects with runtime data)\n```json\n{\n  \"id\": \"data-governance\",\n  \"title\": \"Data & Directory Governance\",\n  \"rules\": [\n    { \"id\": \"DG-1\", \"description\": \"All runtime data paths MUST use centralized path helpers; CWD-relative paths are prohibited\", \"enforced\": true },\n    { \"id\": \"DG-2\", \"description\": \"Checked-in defaults MUST live in seed/; runtime data MUST live in a platform data directory\", \"enforced\": true },\n    { \"id\": \"DG-3\", \"description\": \"New data subdirectories MUST be registered in the centralized path module\", \"enforced\": true }\n  ]\n}\n```\n\n### Resource Management (for long-running services)\n```json\n{\n  \"id\": \"resource-management\",\n  \"title\": \"Resource Management\",\n  \"rules\": [\n    { \"id\": \"RM-1\", \"description\": \"File watchers, intervals, and connections MUST be cleaned up on shutdown\", \"enforced\": true },\n    { \"id\": \"RM-2\", \"description\": \"Child processes MUST have timeouts and MUST be killed on parent shutdown\", \"enforced\": true },\n    { \"id\": \"RM-3\", \"description\": \"Log files SHOULD be bounded; unbounded growth MUST be documented as known limitation\", \"enforced\": false }\n  ]\n}\n```\n\n### Dependencies (recommended for ALL projects)\n```json\n{\n  \"id\": \"dependencies\",\n  \"title\": \"Dependency Management\",\n  \"rules\": [\n    { \"id\": \"DP-1\", \"description\": \"Production dependencies MUST be pinned to exact versions\", \"enforced\": true },\n    { \"id\": \"DP-2\", \"description\": \"Lock files (package-lock.json, poetry.lock, go.sum, etc.) MUST be committed and MUST NOT be manually edited\", \"enforced\": true },\n    { \"id\": \"DP-3\", \"description\": \"New dependencies MUST be justified; prefer existing deps over new packages\", \"enforced\": false }\n  ]\n}\n```\n\n## Governance Policy\n\nInclude in constitution.json or in a separate `.specify/memory/governance.md`:\n\n- Constitution changes require explicit rationale and versioning\n- All features MUST begin as specifications (spec-driven development)\n- Constitution supersedes all other practices\n- Amendments require documentation, approval, and migration plan\n- Machine-checkable gates are maintained alongside human-readable docs\n\n## Derived File Generation\n\nAfter creating or updating constitution.json, regenerate derived files:\n\n1. `docs/constitution.md` — Full human-readable version with enforcement sections\n2. `.specify/memory/constitution.md` — Condensed SpecKit-consumed version\n\nBoth files MUST include the header:\n```\n<!-- AUTO-GENERATED from constitution.json — do not edit directly -->\n```\n\nUse `scripts/sync-constitution.cjs` (or equivalent) to automate regeneration.\n\n**Portability note:** The sync script is language-agnostic in concept (read JSON, write markdown) but the reference implementation is Node.js. For non-Node repos, a 30-line Python or shell script achieves the same result. The key contract is: read constitution.json, emit markdown with `AUTO-GENERATED` header, one section per article.\n\n## Validation Rules\n\n- Every rule ID must be unique across all articles\n- Rule IDs must follow the pattern: `{2-3 letter prefix}-{number}`\n- The prefix must correspond to the article ID\n- All rules must use RFC 2119 keywords (MUST, MUST NOT, SHOULD, etc.)\n- Thresholds must have numeric values >=0\n- Version must be valid semver",
  "priority": 10,
  "audience": "all",
  "requirement": "recommended",
  "categories": [
    "governance",
    "speckit",
    "template",
    "constitution"
  ],
  "primaryCategory": "governance",
  "contentType": "template",
  "schemaVersion": "3",
  "version": "1.7.0",
  "status": "approved",
  "owner": "system",
  "priorityTier": "P1",
  "classification": "internal",
  "semanticSummary": "Canonical constitution.json template with article menu, threshold definitions, governance policy, and derived file generation rules for SpecKit-governed repositories",
  "reviewIntervalDays": 120,
  "changeLog": [
    {
      "version": "1.0.0",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Initial creation — full template with 7 starter articles and governance policies"
    },
    {
      "version": "1.1.0",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Add governance, data-governance, resilience articles; enforced levels; update security to recommended-for-all; fix line limit to 600"
    },
    {
      "version": "1.2.0",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Add data-integrity, resource-management, dependencies articles; fix threshold names; replace persistence with data-integrity"
    },
    {
      "version": "1.2.1",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Add Minimum Viable Constitution section, language-agnostic lock file examples, sync script portability note"
    },
    {
      "version": "1.3.0",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Add Agent Safety & Boundaries, PII & Pre-Commit Hooks (mandatory) articles; strengthen Testing to MUST with coverage tracking and result storage; update minimum viable constitution to 6 articles"
    },
    {
      "version": "1.4.0",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Remove Agent Safety from constitution (→ copilot-instructions); add .env rules (SE-5, SE-6) to Security; refine PH-3 scope; update minimum viable to 5 articles"
    },
    {
      "version": "1.6.0",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Add Repository Structure & Documentation article (RS-1..RS-5): anti-file-creep rule, required docs, Mermaid diagram standards, .specify/ layout enforcement, specs directory convention"
    },
    {
      "version": "1.6.0",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Add TDD ordering rule (TS-7: tests MUST be written and verified FAILING before implementation) and bug regression rule (TS-8: red-green regression tests mandatory for reported bugs)"
    },
    {
      "version": "1.7.0",
      "changedAt": "2026-02-16T00:00:00.000Z",
      "summary": "Add source code design rules: CQ-4 proactive grooming trigger, CQ-5 layered architecture enforcement, CQ-6 domain-concept decomposition, CQ-7 subdirectory barrel exports; strengthen CQ-2 to enforced MUST"
    }
  ]
}
